<p>tl;dr - Bonds can be claimable or slashable, both have different analyses. Bonded off-chain commitments can reduce MEV on ZK and optimistic rollups with some caveats regarding utility functions. Capital requirements for fast finality, however, devolve to those required for a state channel hub. Fairness is hard to enforce. Other forms of off-chain commitments may also be useful.</p><div><hr></div><p>A ZK rollup or optimistic rollup has an operator who batches transactions and publishes them to L1. MEV (technically, operator-extractible value) exists because the operator has the ability to change the order in which those transactions are published. They can also choose not to publish some transactions, or insert transactions of their own to extract value.</p><p></p><p>An operator can, however, make off-chain commitments backed by bonds. This is similar to a state channel. For instance an operator can sign an off-chain message that says your transaction will be included by block X, or that when it is published in block X, the set of transactions preceding it are as follows. Attached to the commitment is a bond on L1. If the operator fails to meet this promise, you as a user can submit the off-chain message on-chain and claim or slash the bond. This can be used to provide fast finality - you don’t have to wait for multiple L1 confirmations before you assume finality of your transaction - same as a state channel. This can also be used to provide MEV resistance - if the operator claims a certain transaction order or nonce for your transaction. These commitments can be provided even before the operator knows the full set of transactions for that block, they just need to know the ones they will place <em>before</em> yours.</p><p><code>The objective of an off-chain commitment is to provide finality over a certain fact, before L1 provides finality for it.</code></p><p></p><p></p><h3>Claimable bonds and bounding of commitments</h3><p>The problem with this model is that there is no way to tell how many commitments have been offered and to whom. If the same bond is claimable between multiple commitments, it is possible for the operator to deliberately not do as promised, and themselves be the person claiming the bond. This results in no net loss to the operator. Even if some other legitimate user claims the bond, this may not benefit you since you may have lost something too from the commitment failing to hold, and you didn’t get compensated.</p><p>Therefore, if bonds are claimable, there needs to be a way to split the bond between commitments and bound the total number of commitments that can be made - to ensure that the sum of claims does not significantly exceed the total bonds available.</p><p></p><p><code>This means that commitments need to expire, so that active commitments don’t grow unbounded.</code></p><p>If a commitment is not published to the chain within X blocks after the block it made for, then it must expire and the bond must no longer be claimable by it. This is a reasonable assumption since optimistic rollup finality too is assumed by sufficient L1 confirmations. 12 blocks can be deemed sufficient for any such commitment to be challenged. Some additional time (some more blocks) can be provided if the number of commitments is large or gas prices are high - since the operator can deliberately increase L1 gasprice to prevent it from being profitable to challenge them. There also needs to be sufficient L1 blockspace to handle a large number of commitments being published and checked.</p><p></p><p>For fast finality, the bond may need to be equal to the transaction amount. For instance if A sends B an amount X on the rollup, the operator can commit to including it within 24 blocks, or else B can go on-chain and just get the amount X directly from the operator’s bond. However, this makes capital lockup requirements immense, and they become as much as those for a state channel hub. The operator may need to have a bond more than the total assets on the rollup, if the rollup is to support large transactions.</p><p>For MEV resistance, however, you do not need as much compensation. The rollup operator just needs to provide more compensation in bonds than the MEV they can otherwise extract by transaction reordering. Then it is economically rational for them to be honest to the commitments they make. Each user needs to be provided more compensation than the MEV extractable from his transaction, if its order in the block is changed.</p><p></p><p>MEV extractable by inserting your own transactions cannot be solved by this technique. </p><p></p><h3>Slashable bonds</h3><p>A slashable bond does not seek to compensate the user for the loss incurred to them, it only makes it bad for the rollup operator to cheat.</p><p></p><p>This is a war of attrition. Both parties lose when the operator cheats, the assumption is that the operator loses more and will therefore not cheat. If the operator loses less than the users, they can, in theory, force a negotiation and change the terms of the deal.</p><p><code>“More” or “less” is not defined in terms of monetary amounts, but in terms of utility.</code></p><p>A user may lose more happiness if their $10,000 transaction on which they assumed finality, does not in fact go through, than the operator may lose if slashed for $50 million. Similarly a user may lose more happiness if they are frontrun by someone else in some auction on L2 (MEV extraction), than the operator loses by losing the same $50 million.</p><p>A negotiation to change the terms may or may not be happen in practice, although it is game-theoretically rational to engage in. It would best be enforced as a set of payments that operator or users make to each other, conditional on which, either the operator of that rollup is changed or the bond is increased. This, however, requires all the users to stop and consider the terms of the negotiation (and trust the operator to encode them properly) instead of just mass exiting.</p><p></p><p>With a slashable bond the bound on commitments might get lowered. Typically the value the operator can personally extract by invalidating off-chain commitments is less than the loss incurred by users when these commitments are invalidated. For instance if commitments are used to provide fast finality, the operator can personally only extract as much value as the users send to the operator directly - and assume finality on. However the operator can cause more loss for the users by also invalidating fast finality on those transactions that do not involve the operator at all. The operator could demand a bribe from the receiving end of these transactions, however, coordinating all this is non-trivial. Game theoretically, I’m not certain there is any situation where there is a relaxation of bounds for commitments. In practice, however, there will be some relaxation.</p><p></p><h3>Shared security</h3><p><code>A slashable bond allows for sharing of security.</code></p><p>The same bond can be shared as a security guarantee by multiple commitments. The bond can even be the very same bond that is used as a guarantee for validity of transactions in the first place. In other words, you can have a single bond which is slashable by anyone who proves an invalid transaction was included or by anyone who proves that an off-chain commitment provided to them was invalidated. A mass exit can also be triggered by the same action (and will almost certainly have to, since the operator now needs to rebuild trust as well as put up new bonds).</p><p>However you still need to ensure the operator has more to lose than everyone else, to ensure a re-negotiation does not take place.</p><p></p><h3>Fairness</h3><p>There is no way to ensure the operator provides these off-chain commitments to every user. The operator may provide them to only some users, or not provide them to anyone. Since these commitments are off-chain, a user cannot prove that commitments were not provided to them, they can only prove if they were. A user can send a message on L1, demanding commitments, but then this forces the operator to publish all data to L1. This does not allow you to do anything faster than L1 finality, which is what off-chain commitments were trying to achieve in the first place.</p><p>The only option a user has it to continue using the rollup without the commitments, or else move to a rollup which they trust is more likely to provide them the commitments. A user can for instance, signal on social media, that the operator didn’t provide them commitments, but the user has no way to cryptographically prove it.</p><p>This signalling can also be done on-chain, and trigger a mass exit. If say 20% of the total assets on the rollup (or off the rollup) vote that they are not being provided the required off-chain commitments, then they can be given authority to trigger a mass exit without having to prove fraud. They should, however, not have the ability to slash or claim a bond, as this gives them power to be malicious against the operator - this devolves to a sidechain-like system.</p><p></p><p>This problem and its solutions are very similar to the censorship problem. Operators get the authority to censor transactions unless decentralised.</p><p></p><h3>Liveness</h3><p>For claimable bonds, the user needs to ideally be online to check that the off-chain commitments made to him are indeed followed. This marginally worsens UX. The user can alternatively publish the off-chain commitment in some off-chain data source and agree to split the bond (if it is claimable) with anyone who actually claims. This split can be enforced on-chain.</p><p>For slashable bonds, no such agreement is required. The user will then just publish the off-chain commitment to this publicly accessible off-chain data source, and hope that there is atleast one live fraud checker. This assumption of atleast one live fraud checker is also the security assumption for optimistic rollups in general. Adding these off-chain commitments increases the computational overhead for the checker by a constant multiple. For a ZK rollup however, it now introduces this new set of actors which are the fraud checkers, since a ZK rollup can otherwise work without them.</p><p></p><h3>Other forms of off-chain commitments</h3><p>So far we have discussed off-chain commitments for complete MEV resistance and fast finality. However there could be other forms of commitments that are also economically useful. </p><p>What MEV is or what it is bounded by, can be narrowed if you narrow down the set of allowed actions or transactions on the rollup. A rollup does not need to be a general-purpose turing-complete accounting system for monetary assets. ZK rollups for instance are immensely useful for actions that are heavy on computation but light on storage. For instance, a rollup that is optimised for checking and incentivising proofs of mathematcal proofs will have completely different notions of MEV or what users want fast commitments on.</p>